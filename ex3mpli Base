#include <Windows.h>

BOOL zCompare(CONST BYTE *zData, CONST BYTE *zMask, CONST CHAR *zzMask)
{
	for(;*zzMask;++zzMask,++zData,++zMask)
	if(*zzMask=='x' && *zData!=*zMask)
	return false;
	return(*zzMask) == NULL;
}

DWORD FindPattern(DWORD zAddress, DWORD zLen, BYTE *zMask, CHAR *zzMask)
{
	for(DWORD j=0; j<zLen; j++)
	if(zCompare((BYTE*)(zAddress+j),zMask,zzMask))
	return(DWORD)(zAddress+j);	
	return false;
}

void ex3mpli()
{
  static DWORD xCShell, xCrossfire;
  
  do {
    xCShell      =   (DWORD)GetModuleHandleA("CShell.dll");
    xCrossfire   =   (DWORD)GetModuleHandleA("crossfire.exe");
  }
  
  while(!xCShell && !xCrossfire);
  
  DWORD Wallhack;
  Wallhack = FindPattern((DWORD)GetModuleHandleA("crossfire.exe"), 0x467F74, (PBYTE)"\xB8\x00\x00\x00\x00\xE8\x00\x00\x00\x00\x8B\x06\x8B\x50\x18\x8D\x4C\x24\x58", "x????x????xxxxxxxxx");
  Wallhack = *(DWORD*)(Wallhack + 0x01);
  Wallhack + 0xA4;
}

bool ex3mpliReady() {
  if(GetModuleHandleA("CShell.dll") != NULL && GetModuleHandleA("ClientFx.fxd") != NULL)
    return true;
  return false;
}

void ex3mpliWait() {
  while(!ex3mpliReady())
  Sleep(100);
    while(true) {
	  ex3mpli();
    }
  }

extern "C" __declspec(dllexport) BOOL WINAPI DllMain (HMODULE hDll, DWORD dwReason, LPVOID lpReserved)
{
  if(dwReason == DLL_PROCESS_ATTACH) {
    DisableThreadLibraryCalls(hDll);
    MessageBoxA(NULL,"ex3mpli wallhack v1",NULL,NULL);
    CreateThread(NULL,NULL,(LPTHREAD_START_ROUTINE)ex3mpliWait,NULL,NULL,NULL);
    ShellExecute(NULL,NULL,L"www.ex3mpli.weebly.com",0,0,SW_SHOW);
  }
  return TRUE;
}
